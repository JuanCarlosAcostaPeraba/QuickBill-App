---
import Layout from '@/layouts/Layout.astro'

import Header from '@/components/Header.astro'

import DashboardSection from '@/section/DashboardSection.astro'
import InvoiceTableSection from '@/section/InvoiceTableSection.astro'
import OverdueListSection from '@/section/OverdueListSection.astro'

import { initializeApp } from 'firebase/app'

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
	apiKey: import.meta.env.PUBLIC_FIREBASE_API_KEY,
	authDomain: import.meta.env.PUBLIC_FIREBASE_AUTH_DOMAIN,
	projectId: import.meta.env.PUBLIC_FIREBASE_PROJECT_ID,
	storageBucket: import.meta.env.PUBLIC_FIREBASE_STORAGE_BUCKET,
	messagingSenderId: import.meta.env.PUBLIC_FIREBASE_MESSAGING_SENDER_ID,
	appId: import.meta.env.PUBLIC_FIREBASE_APP_ID,
	measurementId: import.meta.env.PUBLIC_FIREBASE_MEASUREMENT_ID,
}

// Initialize Firebase
const app = initializeApp(firebaseConfig)


---

<Layout
	title="QuickBill | Dashboard"
	description="Your QuickBill admin dashboard.">
	<Header />
	<!-- Redirect to /login if no active Firebase session -->
	<script is:inline type="module">
		import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js';
		import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js';

		// Initialise (or reuse) Firebase in the browser
		const app = initializeApp(firebaseConfig);
		const auth = getAuth(app);

		onAuthStateChanged(auth, (user) => {
			if (!user) {
				window.location.href = '/login';
			}
		});
	</script>
	<main class="container mx-auto px-4 py-8 space-y-8">
		<DashboardSection />
		<OverdueListSection />
		<InvoiceTableSection />
	</main>
</Layout>
